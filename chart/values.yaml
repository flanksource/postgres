# Default values for postgres chart

# PostgreSQL container image
image:
  registry: ghcr.io
  repository: flanksource/postgres
  tag: "17"
  pullPolicy: IfNotPresent

# Postgres version to run, flanksource/postgres images include multiple versions allowing you to select at runtime
version: "17"
# Automatic upgrade configuration
autoUpgrade:
  enabled: true

# Database configuration
database:
  name: postgres
  username: postgres

# Password secret reference
passwordRef:
  secretName: postgres-password
  key: "password"
  create: true

# PostgreSQL configuration settings
# Individual settings - auto-tuned based on resources if empty
conf:
  listen_addresses: "*"
  log_autovacuum_min_duration: 10s # Set to 0 for pgbadger
  log_connections: off # Set to on for pgbadger
  log_disconnections: off # Set to on for pgbadger
  log_destination: "stderr jsonlog"
  log_directory: "/var/log/postgresql"
  log_file_mode: 0644
  log_filename: "postgresql-%d.log"
  log_line_prefix: "%m [%p] %q[user=%u,db=%d,app=%a] "
  log_lock_waits: on
  log_min_duration_statement: "1s"
  # log_rotation_age: "1d"
  # log_rotation_size: "100MB"
  # log_truncate_on_rotation: on
  log_statement: "all"
  log_temp_files: 100MB # Set to 0 for pgbadger
  log_timezone: "UTC"
  logging_collector: off
  ssl: off
  timezone: "UTC"
  password_encryption: scram-sha-256

# Custom postgresql.conf override (takes precedence over conf)
custom_conf: ""

# Resource configuration
resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 500m
    memory: 1Gi

# Persistence configuration
persistence:
  enabled: true
  # Name of existing PVC to use (mutually exclusive with volumeName)
  existingClaim: ""
  # Name of existing PV to bind to (creates new PVC, mutually exclusive with existingClaim)
  volumeName: ""
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 10Gi
  annotations: {}

# Service configuration
service:
  type: ClusterIP
  port: 5432
  annotations: {}

# ServiceAccount configuration
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod security context
podSecurityContext:
  fsGroup: 999
  runAsUser: 999
  runAsGroup: 999
  fsGroupChangePolicy: "OnRootMismatch"

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 999

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Pod annotations
podAnnotations: {}

# Pod labels
podLabels: {}

# Startup probe configuration
startupProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30
  successThreshold: 1

# Readiness probe configuration
readinessProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# Liveness probe configuration
livenessProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

## Change ownership and permissions of mounted volumes on startup
resetVolumePermissions: true

# Additional environment variables
env: []
# - name: EXAMPLE_ENV
#   value: "example-value"

# Additional volumes
extraVolumes: []

# Additional volume mounts
extraVolumeMounts: []

# Image pull secrets
imagePullSecrets: []

# Name override
nameOverride: ""

# Full name override
fullnameOverride: ""
